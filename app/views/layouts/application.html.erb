<!DOCTYPE html>
<html ng-app="congoApp">
  <head>
    <base href="/">
    <title>Congo2</title>
    <%= stylesheet_link_tag 'application', media: 'all' %>
    <%= javascript_include_tag 'application' %>
    <%= csrf_meta_tags %>

    <script>
      window.congo = {
        currentUser: <%= current_user ? raw(current_user.simple_hash.to_json) : 'null' %>
      }
    </script>
  </head>

  <body ng-controller="MainController">
    <header class="navbar navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".congo-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>

          <a href="/" class="navbar-brand">Grouphub</a>
        </div>

        <nav class="collapse navbar-collapse congo-navbar-collapse">
          <ul class="nav navbar-nav" ng-if="isSignedin() && accountSlug()">
            <li ng-if="hasRole('broker')">
              <a class="heading" ng-href="/accounts/{{accountSlug()}}/products">Products</a>
            </li>

            <li ng-if="hasRole('broker')">
              <a ng-href="/accounts/{{accountSlug()}}/groups">Groups</a>
            </li>
          </ul>

          <ul class="nav navbar-nav navbar-right" ng-if="isSignedin()">
            <li class="dropdown messages-menu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <i class="envelope">Notifications</i>
                <span class="icon-label">99</span>
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a href="">You have 4 messages</a>
                </li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="" class="dropdown-toggle" data-toggle="dropdown">
                {{firstName()}}
                <i class="caret"></i>
              </a>

              <ul class="dropdown-menu">
                <li>
                  <a class="heading" href="">Accounts</a>
                </li>

                <li ng-repeat="account in accounts()">
                  <a ng-href="/accounts/{{account.slug}}">{{account.name}}</a>
                </li>

                <li class="divider" ng-if="accounts().length > 0"></li>

                <li>
                  <a href="" ng-click="signout()">Sign out</a>
                </li>
              </ul>
            </li>
          </ul>

          <ul class="nav navbar-nav navbar-right" ng-if="!isSignedin()">
            <li>
              <a href="/users/signin">Sign in</a>
            </li>

            <li>
              <a href="/users/new_manager">Sign up</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="container">
      <div class="col-md-12">
        <div class="alerts">
          <div ng-repeat="flash in flashes">
            <div class="alert alert-{{flash.type}} fade in">
              <button class="close" data-dismiss="alert">Ã—</button>
              {{flash.message}}
            </div>
          </div>
        </div>

        <%= yield %>
      </div>
    </main>

    <footer>
      &copy; 2014 Grouphub Inc.
    </footer>
  </body>
</html>
