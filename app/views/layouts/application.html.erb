<!DOCTYPE html>
<html ng-app="congoApp">
  <head>
    <base href="/">
    <title>GroupHub</title>
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic' rel='stylesheet' type='text/css'>
    <%= stylesheet_link_tag 'application', media: 'all' %>
    <%= javascript_include_tag 'application' %>
    <%= csrf_meta_tags %>

    <script>
      window.congo = {
        currentUser: <%= current_user ? raw(current_user.simple_hash.to_json) : 'null' %>
      }
    </script>
  </head>

  <body ng-controller="MainController">
    <div id="wrapper" class="toggled" ng-class="showSidebar ? '' : 'toggled'">
      <div id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-brand">
            <a href="#">Start Bootstrap</a>
          </li>

          <li ng-if="hasRole('broker')">
            <a class="heading" ng-href="/accounts/{{accountSlug()}}/{{currentRole()}}/products">Products</a>
          </li>

          <li ng-if="hasRole('broker') || hasRole('customer')">
            <a ng-href="/accounts/{{accountSlug()}}/{{currentRole()}}/groups">Groups</a>
          </li>

          <li>
            <a href="/users/signin">Sign in</a>
          </li>

          <li>
            <a href="/users/new_manager">Sign up</a>
          </li>
        </ul>
      </div>

      <div id="page-content-wrapper">
        <header class="navbar navbar-static-top">
          <nav>
            <ul class="nav navbar-nav">
              <li>
                <a href="" ng-click="toggleSidebar()" class="sidebar-toggle">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </a>
              </li>

              <li>
                <a href="/">
                  <div class="logo"></div>
                </a>
              </li>

              <li class="dropdown messages-menu">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <i class="envelope">Notifications</i>
                  <span class="icon-label">99</span>
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <a href="">You have 4 messages</a>
                  </li>
                </ul>
              </li>

              <li class="dropdown messages-menu">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <i class="forms">To-Dos</i>
                  <span class="icon-label">99</span>
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <a href="">You have 4 to-dos</a>
                  </li>
                </ul>
              </li>

              <li ng-if="firstName()" class="dropdown">
                <a href="" class="dropdown-toggle" data-toggle="dropdown">
                  {{firstName()}}
                  <i class="caret"></i>
                </a>

                <ul class="dropdown-menu">
                  <li>
                    <a class="heading" href="">Accounts</a>
                  </li>

                  <li ng-repeat="account in accounts()">
                    <a ng-href="/accounts/{{account.slug}}/{{account.role}}">
                      {{account.name}}
                      <span class="label label-default role">{{account.role}}</span>
                    </a>
                  </li>

                  <li class="divider" ng-if="accounts().length > 0"></li>

                  <li>
                    <a href="/users/{{currentUserId()}}">My Profile</a>
                  </li>

                  <li>
                    <a href="" ng-click="signout()">Sign out</a>
                  </li>
                </ul>
              </li>
            </ul>
          </nav>
        </header>

        <div ng-repeat="flash in flashes">
          <div class="alert alert-{{flash.type}} fade in">
            <button class="close" data-dismiss="alert">Ã—</button>
            {{flash.message}}
          </div>
        </div>

        <main>
          <%= yield %>
        </main>

        <footer>
          &copy; 2014 GroupHub Inc.
        </footer>
      </div>
    </div>
  </body>
</html>
